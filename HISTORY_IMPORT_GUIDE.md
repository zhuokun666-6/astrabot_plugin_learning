# 历史聊天记录导入功能使用指南

## 功能介绍

本功能允许用户将以前的聊天记录转化为文本文件，然后通过插件导入进行学习。这样可以快速积累大量的训练数据，帮助插件更好地学习用户的说话风格。

## 导入格式要求

### 支持的文本格式

插件支持导入纯文本格式的聊天记录，每条消息需要单独占一行。例如：

```
你好啊，今天天气真不错！
哈哈，是的呢，阳光明媚的
我们去公园散步吧？
好啊好啊，我正想去呢
```

### 支持的时间戳格式（可选）

如果聊天记录中包含时间戳信息，可以按照以下格式添加：

```
[2023-10-05 14:30:00] 你好啊，今天天气真不错！
[2023-10-05 14:31:00] 哈哈，是的呢，阳光明媚的
[2023-10-05 14:32:00] 我们去公园散步吧？
[2023-10-05 14:33:00] 好啊好啊，我正想去呢
```

或者：

```
2023/10/05 14:30:00 你好啊，今天天气真不错！
2023/10/05 14:31:00 哈哈，是的呢，阳光明媚的
2023/10/05 14:32:00 我们去公园散步吧？
2023/10/05 14:33:00 好啊好啊，我正想去呢
```

如果没有时间戳信息，插件会自动生成相对时间戳（每条消息间隔1分钟）。

## 使用方法

### 1. 准备聊天记录文件

将你的历史聊天记录整理成符合上述格式的文本文件（.txt格式）。

### 2. 使用API接口导入

插件提供了`import_chat_history`方法用于导入聊天记录：

```python
import_result = plugin.import_chat_history(
    file_path="path/to/your/chat_history.txt",  # 聊天记录文件路径
    user_id="your_user_id",  # 用户ID
    user_name="your_user_name",  # 用户名
    session_id="your_session_id"  # 会话ID
)
```

### 3. 查看导入结果

导入完成后，会返回一个包含导入结果的字典：

```python
{
    'total_lines': 100,  # 总消息行数
    'imported_lines': 95,  # 成功导入的行数
    'filtered_lines': 3,  # 被过滤的行数
    'duplicate_lines': 2,  # 重复的行数
    'error_lines': 0,  # 错误的行数
    'start_time': 1633456789.123,  # 开始时间
    'end_time': 1633456790.456  # 结束时间
}
```

## 示例

### 创建测试文件

```python
# 创建测试聊天记录文件
with open("test_history.txt", "w", encoding="utf-8") as f:
    f.write("你好啊，今天天气真不错！\n")
    f.write("哈哈，是的呢，阳光明媚的\n")
    f.write("我们去公园散步吧？\n")
    f.write("好啊好啊，我正想去呢\n")
    # 添加更多消息...
```

### 导入测试文件

```python
# 导入聊天记录
import_result = plugin.import_chat_history(
    file_path="test_history.txt",
    user_id="test_user",
    user_name="测试用户",
    session_id="test_session"
)

# 查看结果
print("导入结果:")
print(f"总消息数: {import_result['total_lines']}")
print(f"成功导入: {import_result['imported_lines']}")
print(f"过滤消息: {import_result['filtered_lines']}")
print(f"重复消息: {import_result['duplicate_lines']}")
print(f"错误消息: {import_result['error_lines']}")
print(f"耗时: {import_result['end_time'] - import_result['start_time']:.2f}秒")
```

## 注意事项

1. **文件编码**：请确保聊天记录文件使用UTF-8编码
2. **消息长度**：每条消息的长度建议在1-500个字符之间
3. **文件大小**：建议单次导入的文件大小不超过10MB
4. **敏感内容**：插件会自动过滤敏感词和违规内容
5. **重复检查**：插件会自动去重，避免重复学习相同的消息
6. **批量学习**：导入完成后，插件会自动进行批量学习

## 常见问题

### Q: 为什么有些消息没有被导入？
A: 可能的原因包括：
- 消息长度不符合要求（太短或太长）
- 消息包含敏感词或违规内容
- 消息是重复的
- 消息格式不正确

### Q: 导入后什么时候能看到学习效果？
A: 导入完成后，插件会自动进行批量学习，学习完成后即可看到效果。

### Q: 可以多次导入不同的聊天记录文件吗？
A: 可以，插件支持多次导入，会自动合并所有有效的消息。

### Q: 导入的聊天记录会占用多少存储空间？
A: 插件使用SQLite数据库存储，每条消息占用的空间很小，一般1000条消息只占用几KB的存储空间。

## 性能优化建议

1. 对于大型聊天记录文件，可以分成多个小文件分批导入
2. 导入前可以先手动清理一些无用的消息（如系统消息、广告等）
3. 确保导入时系统资源充足，避免在高负载情况下进行导入操作

---

如果在使用过程中遇到任何问题，请参考插件的日志文件获取详细信息。